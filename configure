#!/usr/bin/env bash

# defaults
prefix="/usr/local"
bindir=""
enable_error_handling=1

show_help() {
    echo "Usage: ./configure [OPTIONS]"
    echo
    echo "Options:"
    echo "  --prefix=DIR                Set installation prefix (default: $prefix)"
    echo "  --bindir=DIR                Set binary directory (default: \$prefix/bin)"
    echo
    echo "  --disable-error-handling    Disable building and installing documentation"
    echo
    echo "  --help                      Show this help message and exit"
    exit 0
}

while [ $# -gt 0 ]; do
  case "$1" in
    --prefix=*)                 prefix="${1#*=}"        ;;
    --bindir=*)                 bindir="${1#*=}"        ;;
    --disable-error-handling)   enable_error_handling=0 ;;
    --help) show_help                ;;
    *) echo "Unknown option: $1" >&2 ;;
  esac
  shift
done

if [ -z "$bindir" ]; then
    bindir="$prefix/bin"
fi

echo "Installation prefix: $prefix"
echo "Binary directory: $bindir"

cat > config.mk <<EOF
PREFIX=$prefix
BINDIR=$bindir
ENABLE_ERROR_HANDLING=$enable_error_handling
EOF

echo "Generated config.mk"
echo "Now run 'make' to build the project."
